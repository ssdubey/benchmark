# this script will create a fresh private ipfs node with given profile (badgerdb,leveldb,fs) and run the python script of benchmark

ipfs shutdown
sleep 3
cp ~/.ipfs/swarm.key /folder/benchmark/
rm -r ~/.ipfs/
ipfs init
cp /folder/benchmark/swarm.key ~/.ipfs/swarm.key
configjson=`cat ~/.ipfs/config`
echo "converting into leveldb"
jq 'del(.Datastore.Spec.mounts[0])' <<< "$configjson" > ~/.ipfs/config
/folder/ipfs-ds-convert convert
IPFS_PATH=~/.ipfs ipfs bootstrap rm --all
#IPFS_PATH=~/.ipfs ipfs bootstrap add /ip4/172.17.0.2/tcp/4001/ipfs/QmU2X9j96fpXLTRe9pYsTK8TMsscPK95CbQs2A4oNNyTdK
export LIBP2P_FORCE_PNET=1
IPFS_PATH=~/.ipfs ipfs daemon &
sleep 6
#python3 /folder/benchmark/src/throughput.py
